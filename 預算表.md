---
layout: page
title: 預算表
permalink: /budget_table/
---

<script>

const base = "https://script.google.com/macros/s/AKfycby7IvcyV9HcIJC_khfr0c0GD91zGrfWdbqHWAIJONyZBsfy9eOQ9UrHyMKOWmpR7ZdtbQ/exec";

const loadContent = async () => {
  const params = { name: "Show Tab Data", sheet: 2 };

  const url = `${base}?${new URLSearchParams(params)}`;
  const res = await fetch(url);
  const data = await res.json();
  const dataContainer = document.createElement('div');
  dataContainer.innerHTML = JSON.stringify(data);
  dataContainer.style.marginTop = '20px';
  document.getElementsByClassName('post-content')[0].appendChild(dataContainer);
};

const showSpinner = () => {
  console.log('顯示 spinner');
  const spinner = document.createElement('div');
  spinner.id = 'loading-spinner';
  spinner.style.position = 'fixed';
  spinner.style.top = '50%';
  spinner.style.left = '50%';
  spinner.style.transform = 'translate(-50%, -50%)';
  spinner.style.zIndex = '99999';
  spinner.style.background = 'rgba(255, 255, 255, 0.95)';
  spinner.style.padding = '20px';
  spinner.style.borderRadius = '8px';
  spinner.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';
  spinner.style.border = '2px solid #3498db';
  spinner.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px;">
      <div style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; transform: none;"></div>
      <span>載入中...</span>
    </div>
  `;
  
  const style = document.createElement('style');
  style.textContent = `
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  `;
  document.head.appendChild(style);
  document.getElementsByClassName('post-content')[0].appendChild(spinner);
  console.log('Spinner 已添加到 post-content');
};

const hideSpinner = () => {
  console.log('隱藏 spinner');
  const spinner = document.getElementById('loading-spinner');
  if (spinner) {
    console.log('找到 spinner，正在移除');
    spinner.remove();
  } else {
    console.log('找不到 spinner');
  }
};

const totalContainer = document.createElement('div');
totalContainer.className = 'total-container';
totalContainer.style.width = 'calc(100% - 2 * max(20px, 5vw))';
totalContainer.style.height = 'calc(35vh - 20px)';
totalContainer.style.minHeight = '200px';
totalContainer.style.margin = '-10px auto -10px auto';
totalContainer.style.position = 'relative';
totalContainer.style.top = '0';
totalContainer.style.left = '0';
totalContainer.style.zIndex = '1000';
totalContainer.style.backgroundColor = 'transparent';
totalContainer.style.borderRadius = '0';
totalContainer.style.boxShadow = 'none';
totalContainer.style.border = 'none';
totalContainer.style.overflow = 'visible';
totalContainer.style.display = 'flex';
totalContainer.style.flexDirection = 'column';
totalContainer.style.justifyContent = 'flex-start';
totalContainer.style.alignItems = 'stretch';

const mobileStyle = document.createElement('style');
mobileStyle.textContent = `
  @media (max-width: 768px) {
    .total-container {
      height: auto !important;
      min-height: 300px !important;
      margin-left: 0 !important;
      margin-right: 0 !important;
      width: 100% !important;
    }
    .content-container {
      flex-direction: row !important;
      width: 100% !important;
    }
    .total-content-container {
      width: 50% !important;
      margin-bottom: 0 !important;
    }
    .pie-chart-container {
      width: 45% !important;
      height: 200px !important;
      margin: 0 0 0 10px !important;
    }
    .budget-cards-container {
      width: 100vw !important;
      margin-left: calc(-50vw + 50%) !important;
      margin-right: calc(-50vw + 50%) !important;
      margin-top: -20px !important;
      padding-left: 15px !important;
      padding-right: 15px !important;
      box-sizing: border-box !important;
      position: relative !important;
    }
    .total-amount-text {
      font-size: 18px !important;
    }
    .total-title-text {
      font-size: 16px !important;
    }
  }
`;
document.head.appendChild(mobileStyle);

const leftArrow = document.createElement('button');
leftArrow.innerHTML = '‹';
leftArrow.style.position = 'absolute';
leftArrow.style.left = '10px';
leftArrow.style.top = '50%';
leftArrow.style.transform = 'translateY(-50%)';
leftArrow.style.zIndex = '1001';
leftArrow.style.width = '30px';
leftArrow.style.height = '30px';
leftArrow.style.border = 'none';
leftArrow.style.borderRadius = '50%';
leftArrow.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
leftArrow.style.color = '#333';
leftArrow.style.fontSize = '18px';
leftArrow.style.cursor = 'pointer';
leftArrow.style.display = 'flex';
leftArrow.style.alignItems = 'center';
leftArrow.style.justifyContent = 'center';

const rightArrow = document.createElement('button');
rightArrow.innerHTML = '›';
rightArrow.style.position = 'absolute';
rightArrow.style.right = '10px';
rightArrow.style.top = '50%';
rightArrow.style.transform = 'translateY(-50%)';
rightArrow.style.zIndex = '1001';
rightArrow.style.width = '30px';
rightArrow.style.height = '30px';
rightArrow.style.border = 'none';
rightArrow.style.borderRadius = '50%';
rightArrow.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
rightArrow.style.color = '#333';
rightArrow.style.fontSize = '18px';
rightArrow.style.cursor = 'pointer';
rightArrow.style.display = 'flex';
rightArrow.style.alignItems = 'center';
rightArrow.style.justifyContent = 'center';

const budgetCardsContainer = document.createElement('div');
budgetCardsContainer.className = 'budget-cards-container';
budgetCardsContainer.style.position = 'relative';
budgetCardsContainer.style.width = '100%';
budgetCardsContainer.style.backgroundColor = 'rgba(255, 255, 255, 0.95)';
budgetCardsContainer.style.borderRadius = '12px';
budgetCardsContainer.style.boxShadow = '0 8px 32px rgba(0,0,0,0.2)';
budgetCardsContainer.style.border = '1px solid rgba(255, 255, 255, 0.2)';
budgetCardsContainer.style.backdropFilter = 'blur(10px)';
budgetCardsContainer.style.overflow = 'auto';
budgetCardsContainer.style.zIndex = '999';
budgetCardsContainer.style.display = 'block';
budgetCardsContainer.style.padding = '20px 20px 20px 20px';
budgetCardsContainer.style.marginTop = '20px';

const budgetCardsTitle = document.createElement('h2');
budgetCardsTitle.textContent = '新增／修改預算';
budgetCardsTitle.style.textAlign = 'center';
budgetCardsTitle.style.margin = '-5px 0 20px 0';
budgetCardsTitle.style.color = '#333';

const createInputRow = (labelText, inputId, inputType = 'text') => {
  const row = document.createElement('div');
  row.style.display = 'flex';
  row.style.alignItems = 'center';
  row.style.justifyContent = 'center';
  row.style.padding = '8px';
  row.style.marginBottom = '8px';
  row.style.width = '100%';
  row.style.boxSizing = 'border-box';
  row.style.gap = '10px';
  
  const label = document.createElement('label');
  label.textContent = labelText;
  label.style.fontSize = '14px';
  label.style.color = '#333';
  label.style.fontWeight = '500';
  label.style.whiteSpace = 'nowrap';
  
  const input = document.createElement('input');
  input.id = inputId;
  input.type = inputType;
  input.style.padding = '6px 10px';
  input.style.border = '1px solid #ddd';
  input.style.borderRadius = '6px';
  input.style.fontSize = '14px';
  input.style.backgroundColor = '#fff';
  input.style.flex = '1';
  
  row.appendChild(label);
  row.appendChild(input);
  return row;
};

const createSelectRow = (labelText, selectId, options) => {
  const row = document.createElement('div');
  row.style.display = 'flex';
  row.style.alignItems = 'center';
  row.style.justifyContent = 'center';
  row.style.padding = '8px';
  row.style.marginBottom = '8px';
  row.style.width = '100%';
  row.style.boxSizing = 'border-box';
  row.style.gap = '10px';
  
  const label = document.createElement('label');
  label.textContent = labelText;
  label.style.fontSize = '14px';
  label.style.color = '#333';
  label.style.fontWeight = '500';
  label.style.whiteSpace = 'nowrap';
  
  const selectContainer = document.createElement('div');
  selectContainer.style.position = 'relative';
  selectContainer.style.flex = '1';
  selectContainer.style.minWidth = '200px';
  
  const selectDisplay = document.createElement('div');
  selectDisplay.style.padding = '6px 10px';
  selectDisplay.style.border = '1px solid #ddd';
  selectDisplay.style.borderRadius = '6px';
  selectDisplay.style.fontSize = '14px';
  selectDisplay.style.backgroundColor = '#fff';
  selectDisplay.style.cursor = 'pointer';
  selectDisplay.style.minHeight = '20px';
  selectDisplay.style.display = 'flex';
  selectDisplay.style.alignItems = 'center';
  selectDisplay.style.justifyContent = 'space-between';
  selectDisplay.style.gap = '8px';
  
  const selectText = document.createElement('div');
  selectText.style.flex = '1';
  selectText.style.wordBreak = 'break-word';
  selectText.style.whiteSpace = 'normal';
  selectText.style.minWidth = '0';
  selectText.textContent = options[0].text;
  
  const selectArrow = document.createElement('div');
  selectArrow.textContent = '▼';
  selectArrow.style.fontSize = '10px';
  selectArrow.style.color = '#666';
  selectArrow.style.transition = 'transform 0.2s';
  selectArrow.style.flexShrink = '0';
  selectArrow.style.lineHeight = '1';
  
  selectDisplay.appendChild(selectText);
  selectDisplay.appendChild(selectArrow);
  
  const hiddenSelect = document.createElement('select');
  hiddenSelect.id = selectId;
  hiddenSelect.style.display = 'none';
  hiddenSelect.value = options[0].value;
  
  const dropdown = document.createElement('div');
  dropdown.style.display = 'none';
  dropdown.style.position = 'absolute';
  dropdown.style.top = '100%';
  dropdown.style.left = '0';
  dropdown.style.right = '0';
  dropdown.style.backgroundColor = '#fff';
  dropdown.style.border = '1px solid #ddd';
  dropdown.style.borderRadius = '6px';
  dropdown.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
  dropdown.style.zIndex = '1000';
  dropdown.style.maxHeight = '200px';
  dropdown.style.overflowY = 'auto';
  dropdown.style.marginTop = '4px';
  
  options.forEach(opt => {
    const option = document.createElement('div');
    option.style.padding = '8px 10px';
    option.style.cursor = 'pointer';
    option.style.fontSize = '14px';
    option.style.wordBreak = 'break-word';
    option.style.whiteSpace = 'normal';
    option.style.borderBottom = '1px solid #f0f0f0';
    option.textContent = opt.text;
    option.dataset.value = opt.value;
    
    option.addEventListener('mouseenter', function() {
      this.style.backgroundColor = '#f5f5f5';
    });
    option.addEventListener('mouseleave', function() {
      this.style.backgroundColor = '#fff';
    });
    
    option.addEventListener('click', function() {
      selectText.textContent = opt.text;
      hiddenSelect.value = opt.value;
      dropdown.style.display = 'none';
      selectArrow.style.transform = 'rotate(0deg)';
      hiddenSelect.dispatchEvent(new Event('change'));
    });
    
    dropdown.appendChild(option);
    const hiddenOption = document.createElement('option');
    hiddenOption.value = opt.value;
    hiddenOption.textContent = opt.text;
    hiddenSelect.appendChild(hiddenOption);
  });
  
  selectDisplay.addEventListener('click', function(e) {
    e.stopPropagation();
    const isOpen = dropdown.style.display === 'block';
    dropdown.style.display = isOpen ? 'none' : 'block';
    selectArrow.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
  });
  
  document.addEventListener('click', function(e) {
    if (!selectContainer.contains(e.target)) {
      dropdown.style.display = 'none';
      selectArrow.style.transform = 'rotate(0deg)';
    }
  });
  
  selectContainer.appendChild(selectDisplay);
  selectContainer.appendChild(dropdown);
  selectContainer.appendChild(hiddenSelect);
  
  row.appendChild(label);
  row.appendChild(selectContainer);
  return row;
};

const div1 = document.createElement('div');
div1.style.display = 'flex';
div1.style.alignItems = 'center';
div1.style.justifyContent = 'center';
div1.style.padding = '8px';
div1.style.marginBottom = '8px';
div1.style.width = '100%';
div1.style.boxSizing = 'border-box';
div1.style.gap = '10px';

const categoryLabel = document.createElement('label');
categoryLabel.textContent = '類別：';
categoryLabel.style.fontSize = '14px';
categoryLabel.style.color = '#333';
categoryLabel.style.fontWeight = '500';
categoryLabel.style.whiteSpace = 'nowrap';

const categorySelectContainer = document.createElement('div');
categorySelectContainer.style.position = 'relative';
categorySelectContainer.style.flex = '1';
categorySelectContainer.style.minWidth = '200px';

const categorySelectDisplay = document.createElement('div');
categorySelectDisplay.style.padding = '6px 10px';
categorySelectDisplay.style.border = '1px solid #ddd';
categorySelectDisplay.style.borderRadius = '6px';
categorySelectDisplay.style.fontSize = '14px';
categorySelectDisplay.style.backgroundColor = '#fff';
categorySelectDisplay.style.cursor = 'pointer';
categorySelectDisplay.style.minHeight = '20px';
categorySelectDisplay.style.display = 'flex';
categorySelectDisplay.style.alignItems = 'center';
categorySelectDisplay.style.justifyContent = 'space-between';
categorySelectDisplay.style.gap = '8px';

const categorySelectText = document.createElement('div');
categorySelectText.style.flex = '1';
categorySelectText.style.wordBreak = 'break-word';
categorySelectText.style.whiteSpace = 'normal';
categorySelectText.style.minWidth = '0';
categorySelectText.textContent = '支出';

const categorySelectArrow = document.createElement('div');
categorySelectArrow.textContent = '▼';
categorySelectArrow.style.fontSize = '10px';
categorySelectArrow.style.color = '#666';
categorySelectArrow.style.transition = 'transform 0.2s';
categorySelectArrow.style.flexShrink = '0';
categorySelectArrow.style.lineHeight = '1';

categorySelectDisplay.appendChild(categorySelectText);
categorySelectDisplay.appendChild(categorySelectArrow);

const categorySelect = document.createElement('select');
categorySelect.style.display = 'none';
categorySelect.value = '支出';
const optionExpense = document.createElement('option');
optionExpense.value = '支出';
optionExpense.textContent = '支出';
const optionIncome = document.createElement('option');
optionIncome.value = '收入';
optionIncome.textContent = '收入';
categorySelect.appendChild(optionExpense);
categorySelect.appendChild(optionIncome);

const categoryDropdown = document.createElement('div');
categoryDropdown.style.display = 'none';
categoryDropdown.style.position = 'absolute';
categoryDropdown.style.top = '100%';
categoryDropdown.style.left = '0';
categoryDropdown.style.right = '0';
categoryDropdown.style.backgroundColor = '#fff';
categoryDropdown.style.border = '1px solid #ddd';
categoryDropdown.style.borderRadius = '6px';
categoryDropdown.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
categoryDropdown.style.zIndex = '1000';
categoryDropdown.style.maxHeight = '200px';
categoryDropdown.style.overflowY = 'auto';
categoryDropdown.style.marginTop = '4px';

const categoryOption1 = document.createElement('div');
categoryOption1.style.padding = '8px 10px';
categoryOption1.style.cursor = 'pointer';
categoryOption1.style.fontSize = '14px';
categoryOption1.style.wordBreak = 'break-word';
categoryOption1.style.whiteSpace = 'normal';
categoryOption1.style.borderBottom = '1px solid #f0f0f0';
categoryOption1.textContent = '支出';
categoryOption1.dataset.value = '支出';

categoryOption1.addEventListener('mouseenter', function() {
  this.style.backgroundColor = '#f5f5f5';
});
categoryOption1.addEventListener('mouseleave', function() {
  this.style.backgroundColor = '#fff';
});
categoryOption1.addEventListener('click', function() {
  categorySelectText.textContent = '支出';
  categorySelect.value = '支出';
  categoryDropdown.style.display = 'none';
  categorySelectArrow.style.transform = 'rotate(0deg)';
  categorySelect.dispatchEvent(new Event('change'));
});

const categoryOption2 = document.createElement('div');
categoryOption2.style.padding = '8px 10px';
categoryOption2.style.cursor = 'pointer';
categoryOption2.style.fontSize = '14px';
categoryOption2.style.wordBreak = 'break-word';
categoryOption2.style.whiteSpace = 'normal';
categoryOption2.textContent = '收入';
categoryOption2.dataset.value = '收入';

categoryOption2.addEventListener('mouseenter', function() {
  this.style.backgroundColor = '#f5f5f5';
});
categoryOption2.addEventListener('mouseleave', function() {
  this.style.backgroundColor = '#fff';
});
categoryOption2.addEventListener('click', function() {
  categorySelectText.textContent = '收入';
  categorySelect.value = '收入';
  categoryDropdown.style.display = 'none';
  categorySelectArrow.style.transform = 'rotate(0deg)';
  categorySelect.dispatchEvent(new Event('change'));
});

categoryDropdown.appendChild(categoryOption1);
categoryDropdown.appendChild(categoryOption2);

categorySelectDisplay.addEventListener('click', function(e) {
  e.stopPropagation();
  const isOpen = categoryDropdown.style.display === 'block';
  categoryDropdown.style.display = isOpen ? 'none' : 'block';
  categorySelectArrow.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
});

document.addEventListener('click', function(e) {
  if (!categorySelectContainer.contains(e.target)) {
    categoryDropdown.style.display = 'none';
    categorySelectArrow.style.transform = 'rotate(0deg)';
  }
});

categorySelectContainer.appendChild(categorySelectDisplay);
categorySelectContainer.appendChild(categoryDropdown);
categorySelectContainer.appendChild(categorySelect);

const div2 = document.createElement('div');
div2.style.display = 'none';
const div3 = document.createElement('div');
div3.style.display = 'none';
const div4 = document.createElement('div');
div4.style.display = 'none';
const div5 = document.createElement('div');
div5.style.display = 'none';

const updateDivVisibility = () => {
  const categoryValue = categorySelect.value;
  
  div2.innerHTML = '';
  div3.innerHTML = '';
  div4.innerHTML = '';
  div5.innerHTML = '';
  
  if (categoryValue === '支出') {
    const categoryRow = createSelectRow('類別：', 'subcategory-select', [
      { value: '生活花費：食', text: '生活花費：食' },
      { value: '生活花費：衣與外貌', text: '生活花費：衣與外貌' },
      { value: '生活花費：住、居家裝修、衛生用品、次月繳納帳單', text: '生活花費：住、居家裝修、衛生用品、次月繳納帳單' },
      { value: '生活花費：行', text: '生活花費：行' },
      { value: '生活花費：育', text: '生活花費：育' },
      { value: '生活花費：樂', text: '生活花費：樂' },
      { value: '生活花費：健（醫療）', text: '生活花費：健（醫療）' },
      { value: '生活花費：帳單', text: '生活花費：帳單' },
      { value: '儲蓄：退休金、醫療預備金、過年紅包支出', text: '儲蓄：退休金、醫療預備金、過年紅包支出' },
      { value: '家人：過年紅包、紀念日', text: '家人：過年紅包、紀念日' }
    ]);
    const projectRow = createInputRow('項目：', 'project-input');
    const amountRow = createInputRow('金額：', 'amount-input', 'number');
    const noteRow = createInputRow('備註：', 'note-input');
    noteRow.style.marginBottom = '0px';
    
    div2.appendChild(categoryRow);
    div3.appendChild(projectRow);
    div4.appendChild(amountRow);
    div5.appendChild(noteRow);
    
    div2.style.display = 'flex';
    div3.style.display = 'flex';
    div4.style.display = 'flex';
    div5.style.display = 'flex';
  } else if (categoryValue === '收入') {
    const projectRow = createInputRow('項目：', 'project-input');
    const amountRow = createInputRow('金額：', 'amount-input', 'number');
    const noteRow = createInputRow('備註：', 'note-input');
    noteRow.style.marginBottom = '0px';
    
    div2.appendChild(projectRow);
    div3.appendChild(amountRow);
    div4.appendChild(noteRow);
    
    div2.style.display = 'flex';
    div3.style.display = 'flex';
    div4.style.display = 'flex';
    div5.style.display = 'none';
  }
};

div1.appendChild(categoryLabel);
div1.appendChild(categorySelectContainer);
budgetCardsContainer.appendChild(budgetCardsTitle);
budgetCardsContainer.appendChild(leftArrow);
budgetCardsContainer.appendChild(rightArrow);
budgetCardsContainer.appendChild(div1);
budgetCardsContainer.appendChild(div2);
budgetCardsContainer.appendChild(div3);
budgetCardsContainer.appendChild(div4);
budgetCardsContainer.appendChild(div5);

categorySelect.addEventListener('change', updateDivVisibility);
updateDivVisibility();

const saveButton = document.createElement('button');
saveButton.textContent = '儲存';
saveButton.style.padding = '10px 20px';
saveButton.style.margin = '5px auto 0 auto';
saveButton.style.display = 'block';
saveButton.style.backgroundColor = '#4CAF50';
saveButton.style.color = '#fff';
saveButton.style.border = 'none';
saveButton.style.borderRadius = '6px';
saveButton.style.fontSize = '16px';
saveButton.style.cursor = 'pointer';
saveButton.style.fontWeight = '500';
saveButton.style.minWidth = '120px';

const saveData = async () => {
  const categoryValue = categorySelect.value;
  const projectInput = document.getElementById('project-input');
  const amountInput = document.getElementById('amount-input');
  const noteInput = document.getElementById('note-input');
  
  if (!projectInput || !amountInput || !noteInput) {
    alert('請等待表單載入完成');
    return;
  }
  
  const item = projectInput.value.trim();
  const cost = parseFloat(amountInput.value);
  const note = noteInput.value.trim();
  
  if (!item) {
    alert('請輸入項目');
    return;
  }
  
  if (!cost || cost <= 0) {
    alert('請輸入有效金額');
    return;
  }
  
  let category = '';
  let range = 0;
  
  if (categoryValue === '支出') {
    const div2Display = window.getComputedStyle(div2).display;
    if (div2Display === 'none' || div2Display === '') {
      alert('請等待表單載入完成');
      return;
    }
    const subcategorySelect = document.getElementById('subcategory-select');
    if (!subcategorySelect) {
      alert('請等待表單載入完成');
      return;
    }
    if (!subcategorySelect.value) {
      alert('請選擇支出類別');
      return;
    }
    category = subcategorySelect.value;
    range = 1;
  } else {
    category = '收入';
    range = 0;
  }
  
  saveButton.textContent = '儲存中...';
  saveButton.disabled = true;
  saveButton.style.opacity = '0.6';
  saveButton.style.cursor = 'not-allowed';
  
  try {
    const postData = {
      name: "Add Data",
      sheet: 2,
      range: range,
      category: category,
      item: item,
      cost: cost,
      note: note
    };
    
    const response = await fetch(base, {
      method: "POST",
      redirect: "follow",
      keepalive: true,
      headers: {
        "Content-Type": "text/plain;charset=utf-8",
      },
      body: JSON.stringify(postData)
    });
    
    if (response.ok) {
      const result = await response.json();
      if (result.success) {
        alert('資料已成功儲存！');
        projectInput.value = '';
        amountInput.value = '';
        noteInput.value = '';
        if (categoryValue === '支出') {
          const subcategorySelect = document.getElementById('subcategory-select');
          if (subcategorySelect && subcategorySelect.options.length > 0) {
            subcategorySelect.value = subcategorySelect.options[0].value;
            const subcategoryText = document.getElementById('subcategory-select-text');
            if (subcategoryText) {
              subcategoryText.textContent = subcategorySelect.options[0].textContent;
            }
          }
        }
      } else {
        alert('儲存失敗: ' + (result.message || '未知錯誤'));
      }
    } else {
      const errorText = await response.text();
      throw new Error(`HTTP error! status: ${response.status}, response: ${errorText}`);
    }
  } catch (error) {
    console.error('儲存失敗:', error);
    alert('儲存失敗: ' + error.message);
  } finally {
    saveButton.textContent = '儲存';
    saveButton.disabled = false;
    saveButton.style.opacity = '1';
    saveButton.style.cursor = 'pointer';
  }
};

saveButton.addEventListener('click', saveData);

const submitContainer = document.createElement('div');
submitContainer.style.width = '100%';
submitContainer.style.display = 'flex';
submitContainer.style.justifyContent = 'center';
submitContainer.style.padding = '0';
submitContainer.appendChild(saveButton);

budgetCardsContainer.appendChild(submitContainer);

const columnsContainer = document.createElement('div');
columnsContainer.style.display = 'flex';
columnsContainer.style.flexDirection = 'column';
columnsContainer.style.gap = '20px';
columnsContainer.style.width = '100%';

const incomeColumn = document.createElement('div');
incomeColumn.style.display = 'flex';
incomeColumn.style.alignItems = 'center';
incomeColumn.style.gap = '15px';

const incomeTitle = document.createElement('h3');
incomeTitle.textContent = '收入：';
incomeTitle.style.margin = '0';
incomeTitle.style.color = '#2e7d32';
incomeTitle.style.fontSize = '18px';
incomeTitle.style.transform = 'translate(20px, 20px)';
incomeTitle.style.fontSize = '20px';

const incomeAmount = document.createElement('div');
incomeAmount.textContent = '$0';
incomeAmount.style.fontSize = '24px';
incomeAmount.style.fontWeight = 'bold';
incomeAmount.style.color = '#2e7d32';
incomeAmount.style.transform = 'translate(20px, 20px)';
incomeAmount.style.fontSize = '28px';

incomeColumn.appendChild(incomeTitle);
incomeColumn.appendChild(incomeAmount);

const expenseColumn = document.createElement('div');
expenseColumn.style.display = 'flex';
expenseColumn.style.alignItems = 'center';
expenseColumn.style.gap = '15px';

const expenseTitle = document.createElement('h3');
expenseTitle.textContent = '支出：';
expenseTitle.style.margin = '0';
expenseTitle.style.color = '#d32f2f';
expenseTitle.style.fontSize = '18px';
expenseTitle.style.transform = 'translate(20px, 20px)';
expenseTitle.style.fontSize = '20px';

const expenseAmount = document.createElement('div');
expenseAmount.textContent = '$0';
expenseAmount.style.fontSize = '24px';
expenseAmount.style.fontWeight = 'bold';
expenseAmount.style.color = '#d32f2f';
expenseAmount.style.transform = 'translate(20px, 20px)';
expenseAmount.style.fontSize = '28px';

expenseColumn.appendChild(expenseTitle);
expenseColumn.appendChild(expenseAmount);

const totalColumn = document.createElement('div');
totalColumn.style.display = 'flex';
totalColumn.style.alignItems = 'center';
totalColumn.style.gap = '15px';

const totalTitle = document.createElement('h3');
totalTitle.textContent = '總計：';
totalTitle.style.margin = '0';
totalTitle.style.color = '#1976d2';
totalTitle.style.fontSize = '18px';
totalTitle.style.transform = 'translate(20px, 20px)';
totalTitle.style.fontSize = '20px';

const totalAmount = document.createElement('div');
totalAmount.textContent = '$0';
totalAmount.style.fontSize = '24px';
totalAmount.style.fontWeight = 'bold';
totalAmount.style.color = '#1976d2';
totalAmount.style.transform = 'translate(20px, 20px)';
totalAmount.style.fontSize = '28px';

totalColumn.appendChild(totalTitle);
totalColumn.appendChild(totalAmount);

columnsContainer.appendChild(incomeColumn);
columnsContainer.appendChild(expenseColumn);
columnsContainer.appendChild(totalColumn);

const totalContainerTitle = document.createElement('h2');
totalContainerTitle.textContent = '總計';
totalContainerTitle.style.textAlign = 'center';
totalContainerTitle.style.margin = '0 auto 10px auto';
totalContainerTitle.style.color = '#333';
totalContainerTitle.style.fontSize = '36px';
totalContainerTitle.style.fontWeight = 'normal';
totalContainerTitle.style.width = '100%';

const pieChartContainer = document.createElement('div');
pieChartContainer.className = 'pie-chart-container';
pieChartContainer.style.width = '100%';
pieChartContainer.style.height = '100%';
pieChartContainer.style.minHeight = '200px';
pieChartContainer.style.margin = '20px 0';
pieChartContainer.style.display = 'flex';
pieChartContainer.style.justifyContent = 'center';
pieChartContainer.style.alignItems = 'center';
pieChartContainer.style.backgroundColor = 'rgba(248, 249, 250, 0.8)';
pieChartContainer.style.borderRadius = '12px';
pieChartContainer.style.border = '3px solid #007bff';

const pieChartPlaceholder = document.createElement('div');
pieChartPlaceholder.textContent = '圓餅圖區域';
pieChartPlaceholder.style.color = '#6c757d';
pieChartPlaceholder.style.fontSize = '18px';
pieChartPlaceholder.style.fontWeight = '500';
pieChartContainer.appendChild(pieChartPlaceholder);

const contentContainer = document.createElement('div');
contentContainer.className = 'content-container';
contentContainer.style.display = 'flex';
contentContainer.style.flexDirection = 'row';
contentContainer.style.justifyContent = 'space-between';
contentContainer.style.alignItems = 'flex-start';
contentContainer.style.width = '100%';

const totalContentContainer = document.createElement('div');
totalContentContainer.className = 'total-content-container';
totalContentContainer.style.width = '45%';
totalContentContainer.style.display = 'flex';
totalContentContainer.style.flexDirection = 'column';
totalContentContainer.style.justifyContent = 'center';
totalContentContainer.style.alignItems = 'center';
totalContentContainer.style.paddingLeft = '0px';
totalContentContainer.style.paddingTop = '0px';
totalContentContainer.appendChild(columnsContainer);

pieChartContainer.style.width = '50%';
pieChartContainer.style.height = 'auto';
pieChartContainer.style.margin = '0';
pieChartContainer.style.display = 'flex';
pieChartContainer.style.justifyContent = 'center';
pieChartContainer.style.alignItems = 'center';

contentContainer.appendChild(totalContentContainer);
contentContainer.appendChild(pieChartContainer);

totalContainer.appendChild(totalContainerTitle);
totalContainer.appendChild(contentContainer);

document.addEventListener('DOMContentLoaded', async function() {
  document.getElementsByClassName('post-content')[0].appendChild(totalContainer);
  document.getElementsByClassName('post-content')[0].appendChild(budgetCardsContainer);

  showSpinner();
  
  try {
    await loadContent();
  } catch (error) {
    console.error('載入失敗:', error);
    const errorContainer = document.createElement('div');
    errorContainer.innerHTML = '載入失敗: ' + error.message;
    errorContainer.style.color = 'red';
    errorContainer.style.marginTop = '20px';
    document.getElementsByClassName('post-content')[0].appendChild(errorContainer);
  } finally {
    hideSpinner();
  }

  buttonContainer.appendChild(createBtn);
  buttonContainer.appendChild(deleteBtn);
  document.getElementsByClassName('post-content')[0].appendChild(buttonContainer);
});


// createBtn.addEventListener('click', function() {
//   const modal = document.createElement('div');
//   modal.style.position = 'fixed';
//   modal.style.top = '0';
//   modal.style.left = '0';
//   modal.style.width = '100%';
//   modal.style.height = '100%';
//   modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
//   modal.style.zIndex = '2000';
//   modal.style.display = 'flex';
//   modal.style.justifyContent = 'center';
//   modal.style.alignItems = 'center';

//   const formContainer = document.createElement('div');
//   formContainer.style.backgroundColor = 'white';
//   formContainer.style.padding = '30px';
//   formContainer.style.borderRadius = '10px';
//   formContainer.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';
//   formContainer.style.width = '400px';
//   formContainer.style.maxWidth = '90vw';

//   const title = document.createElement('h2');
//   title.textContent = '新增資料';
//   title.style.marginTop = '0';
//   title.style.marginBottom = '20px';
//   title.style.textAlign = 'center';
//   title.style.color = '#333';

//   const form = document.createElement('form');
  
//   const fields = [
//     { name: 'sheet', label: 'Sheet', type: 'text', placeholder: '請輸入名稱' },
//     { name: 'range', label: 'Range', type: 'text', placeholder: '請輸入範圍' },
//     { name: 'category', label: 'Category', type: 'text', placeholder: '請輸入類別' },
//     { name: 'item', label: 'Item', type: 'text', placeholder: '請輸入項目名稱' },
//     { name: 'cost', label: 'Cost', type: 'number', placeholder: '請輸入金額' },
//     { name: 'note', label: 'Note', type: 'text', placeholder: '請輸入備註' }
//   ];

//   fields.forEach(field => {
//     const fieldContainer = document.createElement('div');
//     fieldContainer.style.marginBottom = '15px';

//     const label = document.createElement('label');
//     label.textContent = field.label + ':';
//     label.style.display = 'block';
//     label.style.marginBottom = '5px';
//     label.style.fontWeight = 'bold';
//     label.style.color = '#555';

//     const input = document.createElement('input');
//     input.type = field.type;
//     input.name = field.name;
//     input.placeholder = field.placeholder;
//     input.style.width = '100%';
//     input.style.padding = '8px';
//     input.style.border = '1px solid #ddd';
//     input.style.borderRadius = '4px';
//     input.style.fontSize = '14px';
//     input.required = true;

//     fieldContainer.appendChild(label);
//     fieldContainer.appendChild(input);
//     form.appendChild(fieldContainer);
//   });

//   const buttonGroup = document.createElement('div');
//   buttonGroup.style.display = 'flex';
//   buttonGroup.style.justifyContent = 'space-between';
//   buttonGroup.style.marginTop = '20px';

//   const submitBtn = document.createElement('button');
//   submitBtn.type = 'submit';
//   submitBtn.textContent = '提交';
//   submitBtn.style.padding = '10px 20px';
//   submitBtn.style.backgroundColor = '#4CAF50';
//   submitBtn.style.color = 'white';
//   submitBtn.style.border = 'none';
//   submitBtn.style.borderRadius = '4px';
//   submitBtn.style.cursor = 'pointer';
//   submitBtn.style.fontSize = '14px';

//   const cancelBtn = document.createElement('button');
//   cancelBtn.type = 'button';
//   cancelBtn.textContent = '取消';
//   cancelBtn.style.padding = '10px 20px';
//   cancelBtn.style.backgroundColor = '#f44336';
//   cancelBtn.style.color = 'white';
//   cancelBtn.style.border = 'none';
//   cancelBtn.style.borderRadius = '4px';
//   cancelBtn.style.cursor = 'pointer';
//   cancelBtn.style.fontSize = '14px';

//   buttonGroup.appendChild(submitBtn);
//   buttonGroup.appendChild(cancelBtn);

//   form.appendChild(buttonGroup);
//   formContainer.appendChild(title);
//   formContainer.appendChild(form);
//   modal.appendChild(formContainer);
//   document.getElementsByClassName('post-content')[0].appendChild(modal);

//     form.addEventListener('submit', async function(e) {
//       e.preventDefault();
      
//       const formData = new FormData(form);
//       const data = {};
//       for (let [key, value] of formData.entries()) {
//         data[key] = value;
//       }
      
//       const postData = {
//         name: "Add Data",
//         sheet: parseInt(data.sheet) || 2,
//         range: parseInt(data.range) || 0,
//         category: data.category || '',
//         item: data.item || '',
//         cost: parseFloat(data.cost) || 0,
//         note: data.note || ''
//       };
      
//       console.log('提交的資料:', postData);
//       console.log('POST 請求 URL:', base);
      
//       submitBtn.textContent = '提交中...';
//       submitBtn.disabled = true;
      
//       try {
//         const response = await fetch(base, {
//           method: "POST",
//           redirect: "follow",
//           keepalive: true,
//           headers: {
//             "Content-Type": "text/plain;charset=utf-8",
//           },
//           body: JSON.stringify(postData)
//         });
        
//         console.log('回應狀態:', response.status);
//         console.log('回應 headers:', response.headers);
        
//         if (response.ok) {
//           const result = await response.json();
//           console.log('伺服器回應:', result);
//           if (result.success) {
//             alert('資料提交成功！' + (result.message ? '\n' + result.message : ''));
//           } else {
//             alert('提交失敗: ' + result.message);
//           }
//         } else {
//           const errorText = await response.text();
//           console.error('錯誤回應內容:', errorText);
//           throw new Error(`HTTP error! status: ${response.status}, response: ${errorText}`);
//         }
//       } catch (error) {
//         console.error('提交失敗:', error);
//         alert('提交失敗: ' + error.message);
//       } finally {
//         submitBtn.textContent = '提交';
//         submitBtn.disabled = false;
        
//         document.getElementsByClassName('post-content')[0].removeChild(modal);
//       }
//     });

//   cancelBtn.addEventListener('click', function() {
//     document.getElementsByClassName('post-content')[0].removeChild(modal);
//   });

//   modal.addEventListener('click', function(e) {
//     if (e.target === modal) {
//       document.getElementsByClassName('post-content')[0].removeChild(modal);
//     }
//   });
// });

// deleteBtn.addEventListener('click', function() {
//   const modal = document.createElement('div');
//   modal.style.position = 'fixed';
//   modal.style.top = '0';
//   modal.style.left = '0';
//   modal.style.width = '100%';
//   modal.style.height = '100%';
//   modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
//   modal.style.zIndex = '2000';
//   modal.style.display = 'flex';
//   modal.style.justifyContent = 'center';
//   modal.style.alignItems = 'center';

//   const formContainer = document.createElement('div');
//   formContainer.style.backgroundColor = 'white';
//   formContainer.style.padding = '30px';
//   formContainer.style.borderRadius = '10px';
//   formContainer.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';
//   formContainer.style.width = '400px';
//   formContainer.style.maxWidth = '90vw';

//   const title = document.createElement('h2');
//   title.textContent = '刪除資料';
//   title.style.marginTop = '0';
//   title.style.marginBottom = '20px';
//   title.style.textAlign = 'center';
//   title.style.color = '#333';

//   const form = document.createElement('form');
  
//   const fields = [
//     { name: 'sheet', label: 'Sheet', type: 'text', placeholder: '請輸入名稱' },
//     { name: 'range', label: 'Range', type: 'text', placeholder: '請輸入範圍' },
//     { name: 'category', label: 'Category', type: 'text', placeholder: '請輸入類別' },
//     { name: 'item', label: 'Item', type: 'text', placeholder: '請輸入項目名稱' },
//     { name: 'cost', label: 'Cost', type: 'number', placeholder: '請輸入金額' },
//     { name: 'note', label: 'Note', type: 'text', placeholder: '請輸入備註' }
//   ];

//   fields.forEach(field => {
//     const fieldContainer = document.createElement('div');
//     fieldContainer.style.marginBottom = '15px';

//     const label = document.createElement('label');
//     label.textContent = field.label + ':';
//     label.style.display = 'block';
//     label.style.marginBottom = '5px';
//     label.style.fontWeight = 'bold';
//     label.style.color = '#555';

//     const input = document.createElement('input');
//     input.type = field.type;
//     input.name = field.name;
//     input.placeholder = field.placeholder;
//     input.style.width = '100%';
//     input.style.padding = '8px';
//     input.style.border = '1px solid #ddd';
//     input.style.borderRadius = '4px';
//     input.style.fontSize = '14px';
//     input.required = true;

//     fieldContainer.appendChild(label);
//     fieldContainer.appendChild(input);
//     form.appendChild(fieldContainer);
//   });

//   const buttonGroup = document.createElement('div');
//   buttonGroup.style.display = 'flex';
//   buttonGroup.style.justifyContent = 'space-between';
//   buttonGroup.style.marginTop = '20px';

//   const submitBtn = document.createElement('button');
//   submitBtn.type = 'submit';
//   submitBtn.textContent = '提交';
//   submitBtn.style.padding = '10px 20px';
//   submitBtn.style.backgroundColor = '#4CAF50';
//   submitBtn.style.color = 'white';
//   submitBtn.style.border = 'none';
//   submitBtn.style.borderRadius = '4px';
//   submitBtn.style.cursor = 'pointer';
//   submitBtn.style.fontSize = '14px';

//   const cancelBtn = document.createElement('button');
//   cancelBtn.type = 'button';
//   cancelBtn.textContent = '取消';
//   cancelBtn.style.padding = '10px 20px';
//   cancelBtn.style.backgroundColor = '#f44336';
//   cancelBtn.style.color = 'white';
//   cancelBtn.style.border = 'none';
//   cancelBtn.style.borderRadius = '4px';
//   cancelBtn.style.cursor = 'pointer';
//   cancelBtn.style.fontSize = '14px';

//   buttonGroup.appendChild(submitBtn);
//   buttonGroup.appendChild(cancelBtn);

//   form.appendChild(buttonGroup);
//   formContainer.appendChild(title);
//   formContainer.appendChild(form);
//   modal.appendChild(formContainer);
//   document.getElementsByClassName('post-content')[0].appendChild(modal);

//     form.addEventListener('submit', async function(e) {
//       e.preventDefault();
      
//       const formData = new FormData(form);
//       const data = {};
//       for (let [key, value] of formData.entries()) {
//         data[key] = value;
//       }
      
//       const postData = {
//         name: "Delete Data",
//         sheet: parseInt(data.sheet) || 2,
//         range: parseInt(data.range) || 0,
//         category: data.category || '',
//         item: data.item || '',
//         cost: parseFloat(data.cost) || 0,
//         note: data.note || ''
//       };
      
//       console.log('提交的資料:', postData);
//       console.log('POST 請求 URL:', base);
      
//       submitBtn.textContent = '提交中...';
//       submitBtn.disabled = true;
      
//       try {
//         const response = await fetch(base, {
//           method: "POST",
//           redirect: "follow",
//           keepalive: true,
//           headers: {
//             "Content-Type": "text/plain;charset=utf-8",
//           },
//           body: JSON.stringify(postData)
//         });
        
//         console.log('回應狀態:', response.status);
//         console.log('回應 headers:', response.headers);
        
//         if (response.ok) {
//           const result = await response.json();
//           console.log('伺服器回應:', result);
//           if (result.success) {
//             alert('資料提交成功！' + (result.message ? '\n' + result.message : ''));
//           } else {
//             alert('提交失敗: ' + result.message);
//           }
//         } else {
//           const errorText = await response.text();
//           console.error('錯誤回應內容:', errorText);
//           throw new Error(`HTTP error! status: ${response.status}, response: ${errorText}`);
//         }
//       } catch (error) {
//         console.error('提交失敗:', error);
//         alert('提交失敗: ' + error.message);
//       } finally {
//         submitBtn.textContent = '提交';
//         submitBtn.disabled = false;
        
//         document.getElementsByClassName('post-content')[0].removeChild(modal);
//       }
//     });

//   cancelBtn.addEventListener('click', function() {
//     document.getElementsByClassName('post-content')[0].removeChild(modal);
//   });

//   modal.addEventListener('click', function(e) {
//     if (e.target === modal) {
//       document.getElementsByClassName('post-content')[0].removeChild(modal);
//     }
//   });
// });

</script>