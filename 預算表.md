---
layout: page
title: 預算表
permalink: /budget_table/
---

<script>
const base = "https://script.google.com/macros/s/AKfycby7IvcyV9HcIJC_khfr0c0GD91zGrfWdbqHWAIJONyZBsfy9eOQ9UrHyMKOWmpR7ZdtbQ/exec";

const createBtn = document.createElement('button');
createBtn.textContent = 'Create Data';
createBtn.style.padding = '6px 10px';
createBtn.style.border = '1px solid #aaa';
createBtn.style.background = '#f1f1f1';
createBtn.style.borderRadius = '6px';
createBtn.style.cursor = 'pointer';
createBtn.style.marginLeft = '10px';

const deleteBtn = document.createElement('button');
deleteBtn.textContent = 'Delete Data';
deleteBtn.style.padding = '6px 10px';
deleteBtn.style.border = '1px solid #aaa';
deleteBtn.style.background = '#ffebee';
deleteBtn.style.borderRadius = '6px';
deleteBtn.style.cursor = 'pointer';
deleteBtn.style.marginLeft = '10px';

const buttonContainer = document.createElement('div');
buttonContainer.style.position = 'fixed';
buttonContainer.style.top = '20px';
buttonContainer.style.left = '20px';
buttonContainer.style.zIndex = '1000';
buttonContainer.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
buttonContainer.style.padding = '10px';
buttonContainer.style.borderRadius = '8px';
buttonContainer.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';

const loadContent = async () => {
  const params = { name: "Show Tab Data", sheet: 2 };

  const url = `${base}?${new URLSearchParams(params)}`;
  const res = await fetch(url);
  const data = await res.json();
  const sheet = document.getElementById('sheet');
  sheet.innerHTML = JSON.stringify(data);
};

const showSpinner = () => {
  const spinner = document.createElement('div');
  spinner.id = 'loading-spinner';
  spinner.style.position = 'fixed';
  spinner.style.top = '50%';
  spinner.style.left = '50%';
  spinner.style.transform = 'translate(-50%, -50%)';
  spinner.style.zIndex = '9999';
  spinner.style.background = 'rgba(255, 255, 255, 0.9)';
  spinner.style.padding = '20px';
  spinner.style.borderRadius = '8px';
  spinner.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';
  spinner.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px;">
      <div style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
      <span>載入中...</span>
    </div>
  `;
  
  // Add CSS animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  `;
  document.head.appendChild(style);
  
  document.body.appendChild(spinner);
};

const hideSpinner = () => {
  const spinner = document.getElementById('loading-spinner');
  if (spinner) {
    spinner.remove();
  }
};

const sheet = document.createElement('div');
  sheet.id = 'sheet';
  sheet.style.position = 'fixed';
  sheet.style.top = '0';
  sheet.style.left = '0';
  sheet.style.width = '100%';
  sheet.style.height = '100vh';
  sheet.style.overflow = 'auto';
  sheet.style.border = '1px solid #ddd';
  sheet.style.borderRadius = '8px';
  sheet.style.padding = '20px';


document.addEventListener('DOMContentLoaded', async function() {
  showSpinner();
  
  try {
    await loadContent();
  } catch (error) {
    console.error('載入失敗:', error);
    const sheet = document.getElementById('sheet');
    sheet.innerHTML = '載入失敗: ' + error.message;
  } finally {
    hideSpinner();
  }
  
  buttonContainer.appendChild(createBtn);
  buttonContainer.appendChild(deleteBtn);
  document.body.appendChild(buttonContainer);
  document.body.appendChild(sheet);
});


createBtn.addEventListener('click', function() {
  const modal = document.createElement('div');
  modal.style.position = 'fixed';
  modal.style.top = '0';
  modal.style.left = '0';
  modal.style.width = '100%';
  modal.style.height = '100%';
  modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
  modal.style.zIndex = '2000';
  modal.style.display = 'flex';
  modal.style.justifyContent = 'center';
  modal.style.alignItems = 'center';

  const formContainer = document.createElement('div');
  formContainer.style.backgroundColor = 'white';
  formContainer.style.padding = '30px';
  formContainer.style.borderRadius = '10px';
  formContainer.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';
  formContainer.style.width = '400px';
  formContainer.style.maxWidth = '90vw';

  const title = document.createElement('h2');
  title.textContent = '新增資料';
  title.style.marginTop = '0';
  title.style.marginBottom = '20px';
  title.style.textAlign = 'center';
  title.style.color = '#333';

  const form = document.createElement('form');
  
  const fields = [
    { name: 'sheet', label: 'Sheet', type: 'text', placeholder: '請輸入名稱' },
    { name: 'range', label: 'Range', type: 'text', placeholder: '請輸入範圍' },
    { name: 'category', label: 'Category', type: 'text', placeholder: '請輸入類別' },
    { name: 'item', label: 'Item', type: 'text', placeholder: '請輸入項目名稱' },
    { name: 'cost', label: 'Cost', type: 'number', placeholder: '請輸入金額' },
    { name: 'note', label: 'Note', type: 'text', placeholder: '請輸入備註' }
  ];

  fields.forEach(field => {
    const fieldContainer = document.createElement('div');
    fieldContainer.style.marginBottom = '15px';

    const label = document.createElement('label');
    label.textContent = field.label + ':';
    label.style.display = 'block';
    label.style.marginBottom = '5px';
    label.style.fontWeight = 'bold';
    label.style.color = '#555';

    const input = document.createElement('input');
    input.type = field.type;
    input.name = field.name;
    input.placeholder = field.placeholder;
    input.style.width = '100%';
    input.style.padding = '8px';
    input.style.border = '1px solid #ddd';
    input.style.borderRadius = '4px';
    input.style.fontSize = '14px';
    input.required = true;

    fieldContainer.appendChild(label);
    fieldContainer.appendChild(input);
    form.appendChild(fieldContainer);
  });

  const buttonGroup = document.createElement('div');
  buttonGroup.style.display = 'flex';
  buttonGroup.style.justifyContent = 'space-between';
  buttonGroup.style.marginTop = '20px';

  const submitBtn = document.createElement('button');
  submitBtn.type = 'submit';
  submitBtn.textContent = '提交';
  submitBtn.style.padding = '10px 20px';
  submitBtn.style.backgroundColor = '#4CAF50';
  submitBtn.style.color = 'white';
  submitBtn.style.border = 'none';
  submitBtn.style.borderRadius = '4px';
  submitBtn.style.cursor = 'pointer';
  submitBtn.style.fontSize = '14px';

  const cancelBtn = document.createElement('button');
  cancelBtn.type = 'button';
  cancelBtn.textContent = '取消';
  cancelBtn.style.padding = '10px 20px';
  cancelBtn.style.backgroundColor = '#f44336';
  cancelBtn.style.color = 'white';
  cancelBtn.style.border = 'none';
  cancelBtn.style.borderRadius = '4px';
  cancelBtn.style.cursor = 'pointer';
  cancelBtn.style.fontSize = '14px';

  buttonGroup.appendChild(submitBtn);
  buttonGroup.appendChild(cancelBtn);

  form.appendChild(buttonGroup);
  formContainer.appendChild(title);
  formContainer.appendChild(form);
  modal.appendChild(formContainer);
  document.body.appendChild(modal);

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(form);
      const data = {};
      for (let [key, value] of formData.entries()) {
        data[key] = value;
      }
      
      // 按照 Google Apps Script 的格式重新組織資料
      const postData = {
        name: "Add Data",  // 對應 doPost 中的操作類型
        sheet: parseInt(data.sheet) || 2,  // 確保是數字，預設為 2
        range: parseInt(data.range) || 0,  // 確保是數字，預設為 0
        category: data.category || '',
        item: data.item || '',
        cost: parseFloat(data.cost) || 0,  // 確保是數字
        note: data.note || ''
      };
      
      console.log('提交的資料:', postData);
      console.log('POST 請求 URL:', base);
      
      submitBtn.textContent = '提交中...';
      submitBtn.disabled = true;
      
      try {
        const response = await fetch(base, {
          method: "POST",
          redirect: "follow",
          keepalive: true,
          headers: {
            "Content-Type": "text/plain;charset=utf-8",
          },
          body: JSON.stringify(postData)
        });
        
        console.log('回應狀態:', response.status);
        console.log('回應 headers:', response.headers);
        
        if (response.ok) {
          const result = await response.json();
          console.log('伺服器回應:', result);
          if (result.success) {
            alert('資料提交成功！' + (result.message ? '\n' + result.message : ''));
          } else {
            alert('提交失敗: ' + result.message);
          }
        } else {
          const errorText = await response.text();
          console.error('錯誤回應內容:', errorText);
          throw new Error(`HTTP error! status: ${response.status}, response: ${errorText}`);
        }
      } catch (error) {
        console.error('提交失敗:', error);
        alert('提交失敗: ' + error.message);
      } finally {
        submitBtn.textContent = '提交';
        submitBtn.disabled = false;
        
        document.body.removeChild(modal);
      }
    });

  cancelBtn.addEventListener('click', function() {
    document.body.removeChild(modal);
  });

  modal.addEventListener('click', function(e) {
    if (e.target === modal) {
      document.body.removeChild(modal);
    }
  });
});

deleteBtn.addEventListener('click', function() {
  const modal = document.createElement('div');
  modal.style.position = 'fixed';
  modal.style.top = '0';
  modal.style.left = '0';
  modal.style.width = '100%';
  modal.style.height = '100%';
  modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
  modal.style.zIndex = '2000';
  modal.style.display = 'flex';
  modal.style.justifyContent = 'center';
  modal.style.alignItems = 'center';

  const formContainer = document.createElement('div');
  formContainer.style.backgroundColor = 'white';
  formContainer.style.padding = '30px';
  formContainer.style.borderRadius = '10px';
  formContainer.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';
  formContainer.style.width = '400px';
  formContainer.style.maxWidth = '90vw';

  const title = document.createElement('h2');
  title.textContent = '刪除資料';
  title.style.marginTop = '0';
  title.style.marginBottom = '20px';
  title.style.textAlign = 'center';
  title.style.color = '#333';

  const form = document.createElement('form');
  
  const fields = [
    { name: 'sheet', label: 'Sheet', type: 'text', placeholder: '請輸入名稱' },
    { name: 'range', label: 'Range', type: 'text', placeholder: '請輸入範圍' },
    { name: 'category', label: 'Category', type: 'text', placeholder: '請輸入類別' },
    { name: 'item', label: 'Item', type: 'text', placeholder: '請輸入項目名稱' },
    { name: 'cost', label: 'Cost', type: 'number', placeholder: '請輸入金額' },
    { name: 'note', label: 'Note', type: 'text', placeholder: '請輸入備註' }
  ];

  fields.forEach(field => {
    const fieldContainer = document.createElement('div');
    fieldContainer.style.marginBottom = '15px';

    const label = document.createElement('label');
    label.textContent = field.label + ':';
    label.style.display = 'block';
    label.style.marginBottom = '5px';
    label.style.fontWeight = 'bold';
    label.style.color = '#555';

    const input = document.createElement('input');
    input.type = field.type;
    input.name = field.name;
    input.placeholder = field.placeholder;
    input.style.width = '100%';
    input.style.padding = '8px';
    input.style.border = '1px solid #ddd';
    input.style.borderRadius = '4px';
    input.style.fontSize = '14px';
    input.required = true;

    fieldContainer.appendChild(label);
    fieldContainer.appendChild(input);
    form.appendChild(fieldContainer);
  });

  const buttonGroup = document.createElement('div');
  buttonGroup.style.display = 'flex';
  buttonGroup.style.justifyContent = 'space-between';
  buttonGroup.style.marginTop = '20px';

  const submitBtn = document.createElement('button');
  submitBtn.type = 'submit';
  submitBtn.textContent = '提交';
  submitBtn.style.padding = '10px 20px';
  submitBtn.style.backgroundColor = '#4CAF50';
  submitBtn.style.color = 'white';
  submitBtn.style.border = 'none';
  submitBtn.style.borderRadius = '4px';
  submitBtn.style.cursor = 'pointer';
  submitBtn.style.fontSize = '14px';

  const cancelBtn = document.createElement('button');
  cancelBtn.type = 'button';
  cancelBtn.textContent = '取消';
  cancelBtn.style.padding = '10px 20px';
  cancelBtn.style.backgroundColor = '#f44336';
  cancelBtn.style.color = 'white';
  cancelBtn.style.border = 'none';
  cancelBtn.style.borderRadius = '4px';
  cancelBtn.style.cursor = 'pointer';
  cancelBtn.style.fontSize = '14px';

  buttonGroup.appendChild(submitBtn);
  buttonGroup.appendChild(cancelBtn);

  form.appendChild(buttonGroup);
  formContainer.appendChild(title);
  formContainer.appendChild(form);
  modal.appendChild(formContainer);
  document.body.appendChild(modal);

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(form);
      const data = {};
      for (let [key, value] of formData.entries()) {
        data[key] = value;
      }
      
      // 按照 Google Apps Script 的格式重新組織資料
      const postData = {
        name: "Delete Data",  // 對應 doPost 中的操作類型
        sheet: parseInt(data.sheet) || 2,  // 確保是數字，預設為 2
        range: parseInt(data.range) || 0,  // 確保是數字，預設為 0
        category: data.category || '',
        item: data.item || '',
        cost: parseFloat(data.cost) || 0,  // 確保是數字
        note: data.note || ''
      };
      
      console.log('提交的資料:', postData);
      console.log('POST 請求 URL:', base);
      
      submitBtn.textContent = '提交中...';
      submitBtn.disabled = true;
      
      try {
        const response = await fetch(base, {
          method: "POST",
          redirect: "follow",
          keepalive: true,
          headers: {
            "Content-Type": "text/plain;charset=utf-8",
          },
          body: JSON.stringify(postData)
        });
        
        console.log('回應狀態:', response.status);
        console.log('回應 headers:', response.headers);
        
        if (response.ok) {
          const result = await response.json();
          console.log('伺服器回應:', result);
          if (result.success) {
            alert('資料提交成功！' + (result.message ? '\n' + result.message : ''));
          } else {
            alert('提交失敗: ' + result.message);
          }
        } else {
          const errorText = await response.text();
          console.error('錯誤回應內容:', errorText);
          throw new Error(`HTTP error! status: ${response.status}, response: ${errorText}`);
        }
      } catch (error) {
        console.error('提交失敗:', error);
        alert('提交失敗: ' + error.message);
      } finally {
        submitBtn.textContent = '提交';
        submitBtn.disabled = false;
        
        document.body.removeChild(modal);
      }
    });

  cancelBtn.addEventListener('click', function() {
    document.body.removeChild(modal);
  });

  modal.addEventListener('click', function(e) {
    if (e.target === modal) {
      document.body.removeChild(modal);
    }
  });
});

</script>
